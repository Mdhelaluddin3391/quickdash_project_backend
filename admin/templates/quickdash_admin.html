<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>QuickDash — Admin Panel</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
/* =============================
   CORE VARIABLES (Dark Neon)
============================= */
:root{
  --bg-0:#071025;
  --bg-1:#0b1230;
  --card:#0e152f;
  --border:#1a2342;
  --neon1:#55f0ff;
  --neon2:#7a5bff;
  --text:#dbe7ff;
  --muted:#9aa7c7;
  --radius:12px;
  --shadow:0 6px 20px rgba(1,4,20,0.7);
}

/* =============================
   BASIC RESET
============================= */
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%}
body{
  background:
    radial-gradient(1200px 600px at 10% 10%, rgba(60,90,255,0.06), transparent),
    radial-gradient(900px 500px at 90% 80%, rgba(85,240,255,0.04), transparent),
    var(--bg-0);
  color:var(--text);
  font-family:Inter,system-ui,-apple-system,"Segoe UI",sans-serif;
}

/* =============================
   LAYOUT
============================= */
.app{
  display:flex;
  min-height:100vh;
}

/* SIDEBAR */
.sidebar{
  width:260px;
  background:linear-gradient(180deg,#0d1433,#050a1f);
  border-right:1px solid var(--border);
  padding:18px 18px 24px;
  position:fixed;
  top:0;left:0;bottom:0;
  box-shadow:var(--shadow);
}
.sidebar .logo{
  display:flex;
  gap:12px;
  align-items:center;
  margin-bottom:20px;
}
.logo-box{
  width:46px;height:46px;border-radius:10px;
  background:linear-gradient(135deg,var(--neon2),var(--neon1));
  display:flex;align-items:center;justify-content:center;
  color:#001a24;font-weight:800;font-size:18px;
  box-shadow:0 8px 24px rgba(85,240,255,0.25);
}
.logo-text-title{
  font-size:14px;
  font-weight:600;
  color:#cde6ff;
}
.logo-text-sub{
  font-size:12px;
  color:var(--muted);
}

/* NAV */
.nav-heading{
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:0.08em;
  color:var(--muted);
  margin-bottom:6px;
}
.nav ul{list-style:none;margin-bottom:16px}
.nav li{
  padding:9px 10px;
  border-radius:10px;
  display:flex;
  align-items:center;
  gap:10px;
  cursor:pointer;
  margin-bottom:4px;
  transition:0.18s;
  font-size:14px;
}
.nav li i{
  width:22px;
  text-align:center;
  color:var(--neon1);
}
.nav li span{flex:1}
.nav li:hover{
  background:rgba(255,255,255,0.04);
  transform:translateX(4px);
}
.nav li.active{
  background:linear-gradient(90deg,rgba(122,91,255,0.18),rgba(85,240,255,0.06));
  border-left:3px solid var(--neon1);
}

/* MAIN */
.main{
  margin-left:260px;
  flex:1;
  min-height:100vh;
  display:flex;
  flex-direction:column;
}

/* HEADER */
.header{
  height:64px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 26px;
  border-bottom:1px solid var(--border);
  background:rgba(3,7,30,0.8);
  backdrop-filter:blur(8px);
  position:sticky;
  top:0;
  z-index:10;
}
.header-left h2{
  font-size:18px;
  color:var(--neon1);
}
.header-left small{
  display:block;
  font-size:11px;
  color:var(--muted);
}
.header-right{
  display:flex;
  align-items:center;
  gap:14px;
}
.search-box{
  position:relative;
}
.search-box input{
  width:260px;
  padding:8px 34px 8px 12px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#050b23;
  color:var(--text);
  outline:none;
  font-size:13px;
}
.search-box input::placeholder{color:var(--muted)}
.search-box i{
  position:absolute;
  right:10px;
  top:50%;
  transform:translateY(-50%);
  color:var(--muted);
  font-size:13px;
}
.header-avatar{
  width:34px;height:34px;border-radius:10px;
  background:linear-gradient(135deg,#1f2937,#020617);
  border:1px solid var(--border);
  display:flex;align-items:center;justify-content:center;
  color:var(--muted);
}

/* CONTENT */
.content{
  padding:22px 26px 28px;
}

/* PAGE WRAPPER */
.page{display:none}
.page.page-active{display:block}
.page-header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:14px;
}
.page-header h3{
  font-size:18px;
}
.page-header small{
  font-size:12px;
  color:var(--muted);
}

/* CARDS */
.card{
  background:var(--card);
  border-radius:var(--radius);
  padding:16px 16px 14px;
  border:1px solid var(--border);
  box-shadow:var(--shadow);
}

/* STATS */
.stats-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:14px;
  margin-bottom:18px;
}
.stat-card{
  display:flex;
  align-items:center;
  gap:10px;
}
.stat-icon{
  width:40px;height:40px;border-radius:10px;
  display:flex;align-items:center;justify-content:center;
  background:linear-gradient(135deg,rgba(122,91,255,0.24),rgba(85,240,255,0.18));
  color:var(--neon1);
}
.stat-meta{font-size:12px;color:var(--muted)}
.stat-value{font-size:18px;font-weight:600}

/* TABLES */
.table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
.table th,
.table td{
  text-align:left;
  padding:10px 8px;
  border-bottom:1px solid #121b3a;
}
.table th{
  font-size:12px;
  color:var(--muted);
  text-transform:uppercase;
  letter-spacing:0.06em;
}
.table tr:hover{
  background:#0d1636;
}

/* STATUS BADGES */
.badge{
  padding:4px 8px;
  border-radius:999px;
  font-size:11px;
  font-weight:600;
  display:inline-block;
}
.s-pending{background:rgba(255,205,92,0.12);color:#ffd66b}
.s-processing{background:rgba(122,91,255,0.15);color:#7a5bff}
.s-packed{background:rgba(0,200,255,0.16);color:#55f0ff}
.s-dispatched{background:rgba(96,165,250,0.16);color:#7dd3fc}
.s-delivered{background:rgba(32,227,165,0.18);color:#20e3a5}
.s-cancelled{background:rgba(255,107,129,0.12);color:#ff6b81}

/* BUTTONS */
.btn{
  border:none;
  border-radius:8px;
  padding:8px 12px;
  font-size:13px;
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  gap:6px;
}
.btn-primary{
  background:linear-gradient(90deg,var(--neon2),var(--neon1));
  color:#00121f;
  font-weight:600;
}
.btn-soft{
  background:#050b23;
  color:var(--text);
  border:1px solid var(--border);
}
.btn-sm{
  padding:6px 10px;
  font-size:12px;
}

/* PAGINATION */
.pagination{
  display:flex;
  gap:6px;
  margin-top:14px;
  flex-wrap:wrap;
}
.pagination button{
  padding:6px 10px;
  border-radius:6px;
  border:1px solid var(--border);
  background:#050b23;
  color:var(--text);
  font-size:12px;
  cursor:pointer;
}
.pagination button.active{
  background:var(--neon2);
  color:#00121f;
  border-color:transparent;
}

/* ORDER DETAILS PANEL */
.order-details-backdrop{
  position:fixed;
  inset:0;
  background:rgba(3,6,23,0.6);
  display:none;
  justify-content:flex-end;
  z-index:40;
}
.order-details-backdrop.open{display:flex}
.order-details{
  width:380px;
  max-width:100%;
  height:100%;
  background:#050b23;
  border-left:1px solid var(--border);
  padding:18px 18px 20px;
  overflow-y:auto;
}
.order-details-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}
.order-details h3{font-size:16px}
.order-details-section-title{
  margin-top:12px;
  font-size:13px;
  font-weight:600;
}
.order-details p{
  font-size:13px;
  margin-top:4px;
}
.order-items{
  margin-top:6px;
  font-size:13px;
}
.order-items-row{
  display:flex;
  justify-content:space-between;
}
.timeline{
  margin-top:4px;
  font-size:12px;
  color:var(--muted);
}
.timeline span{
  display:inline-block;
  padding:3px 7px;
  border-radius:999px;
  background:#050b23;
  border:1px solid var(--border);
  margin:2px 4px 2px 0;
}

/* ORDER ACTIONS */
.actions-block{
  margin-top:14px;
}
.actions-block h4{
  font-size:13px;
  margin-bottom:6px;
}
.actions-block .btn{
  width:100%;
  justify-content:center;
  margin-top:6px;
}

/* SIMPLE RESPONSIVE */
@media(max-width:900px){
  .sidebar{display:none}
  .main{margin-left:0}
}
</style>
</head>
<body>
<div class="app">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo">
      <div class="logo-box">QD</div>
      <div>
        <div class="logo-text-title">QuickDash</div>
        <div class="logo-text-sub">Admin Panel</div>
      </div>
    </div>

    <nav class="nav">
      <div class="nav-heading">Main</div>
      <ul>
        <li data-page="dashboard" class="active"><i class="fa-solid fa-house"></i><span>Dashboard</span></li>
        <li data-page="orders"><i class="fa-solid fa-bell"></i><span>Live Orders</span></li>
        <li data-page="riders"><i class="fa-solid fa-motorcycle"></i><span>Riders</span></li>
        <li data-page="customers"><i class="fa-solid fa-users"></i><span>Customers</span></li>
        <li data-page="inventory"><i class="fa-solid fa-boxes-stacked"></i><span>Inventory</span></li>
        <li data-page="warehouse"><i class="fa-solid fa-warehouse"></i><span>Warehouse</span></li>
        <li data-page="analytics"><i class="fa-solid fa-chart-line"></i><span>Analytics</span></li>
        <li data-page="settings"><i class="fa-solid fa-gear"></i><span>Settings</span></li>
      </ul>
    </nav>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <header class="header">
      <div class="header-left">
        <h2>QuickDash Admin</h2>
        <small>Quick commerce control center</small>
      </div>
      <div class="header-right">
        <div class="search-box">
          <input id="globalSearch" placeholder="Search orders, riders, customers (demo)" />
          <i class="fa-solid fa-magnifying-glass"></i>
        </div>
        <div class="header-avatar"><i class="fa-regular fa-user"></i></div>
      </div>
    </header>

    <section class="content">

      <!-- DASHBOARD PAGE -->
      <div class="page page-active" id="dashboardPage">
        <div class="page-header">
          <div>
            <h3>Dashboard Overview</h3>
            <small>Today’s summary</small>
          </div>
        </div>

        <div class="stats-grid">
          <div class="card stat-card">
            <div class="stat-icon"><i class="fa-solid fa-bell"></i></div>
            <div>
              <div class="stat-meta">Orders Today</div>
              <div class="stat-value" id="statTotalOrders">0</div>
            </div>
          </div>
          <div class="card stat-card">
            <div class="stat-icon"><i class="fa-solid fa-motorcycle"></i></div>
            <div>
              <div class="stat-meta">Active Riders</div>
              <div class="stat-value" id="statRiders">0</div>
            </div>
          </div>
          <div class="card stat-card">
            <div class="stat-icon"><i class="fa-solid fa-users"></i></div>
            <div>
              <div class="stat-meta">Customers</div>
              <div class="stat-value" id="statCustomers">0</div>
            </div>
          </div>
          <div class="card stat-card">
            <div class="stat-icon"><i class="fa-solid fa-boxes-stacked"></i></div>
            <div>
              <div class="stat-meta">Inventory SKUs</div>
              <div class="stat-value" id="statInventory">0</div>
            </div>
          </div>
        </div>

        <div class="card">
          <h4>Recent Orders (demo)</h4>
          <table class="table" id="recentOrdersTable">
            <thead>
              <tr><th>Order ID</th><th>Customer</th><th>Status</th><th>Amount</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- LIVE ORDERS PAGE -->
      <div class="page" id="ordersPage">
        <div class="page-header">
          <div>
            <h3>Live Orders</h3>
            <small>All current orders with packer & rider</small>
          </div>
          <div class="search-box">
            <input id="orderSearch" placeholder="Search by Order ID..." />
            <i class="fa-solid fa-magnifying-glass"></i>
          </div>
        </div>

        <div class="card">
          <table class="table" id="ordersTable">
            <thead>
              <tr>
                <th>Order ID</th>
                <th>Status</th>
                <th>Customer</th>
                <th>Packer</th>
                <th>Rider</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>

          <div class="pagination" id="ordersPagination"></div>
        </div>
      </div>

      <!-- RIDERS PAGE -->
      <div class="page" id="ridersPage">
        <div class="page-header">
          <div>
            <h3>Riders</h3>
            <small>Fleet overview</small>
          </div>
        </div>
        <div class="card">
          <table class="table" id="ridersTable">
            <thead>
              <tr><th>Rider ID</th><th>Name</th><th>Orders Today</th><th>Status</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- CUSTOMERS PAGE -->
      <div class="page" id="customersPage">
        <div class="page-header">
          <div>
            <h3>Customers</h3>
            <small>Top customers (demo)</small>
          </div>
        </div>
        <div class="card">
          <table class="table" id="customersTable">
            <thead>
              <tr><th>ID</th><th>Name</th><th>Email</th><th>Orders</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- INVENTORY PAGE -->
      <div class="page" id="inventoryPage">
        <div class="page-header">
          <div>
            <h3>Inventory</h3>
            <small>Key SKUs</small>
          </div>
        </div>
        <div class="card">
          <table class="table" id="inventoryTable">
            <thead>
              <tr><th>SKU</th><th>Product</th><th>Qty</th><th>Low?</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- WAREHOUSE PAGE -->
      <div class="page" id="warehousePage">
        <div class="page-header">
          <div>
            <h3>Warehouse</h3>
            <small>Simple snapshot</small>
          </div>
        </div>
        <div class="card" id="warehouseCard">
          <!-- JS will inject bins summary -->
        </div>
      </div>

      <!-- ANALYTICS PAGE -->
      <div class="page" id="analyticsPage">
        <div class="page-header">
          <div>
            <h3>Analytics</h3>
            <small>Demo placeholders</small>
          </div>
        </div>
        <div class="card">
          Charts & reports (future)
        </div>
      </div>

      <!-- SETTINGS PAGE -->
      <div class="page" id="settingsPage">
        <div class="page-header">
          <div>
            <h3>Settings</h3>
            <small>Basic settings (demo)</small>
          </div>
        </div>
        <div class="card">
          <p style="font-size:13px;color:var(--muted)">Theme: Dark Neon (fixed in this demo)</p>
        </div>
      </div>

    </section>
  </main>
</div>

<!-- ORDER DETAILS OFFCANVAS -->
<div class="order-details-backdrop" id="orderDetailsBackdrop">
  <div class="order-details">
    <div class="order-details-header">
      <h3 id="detailOrderId">Order</h3>
      <button class="btn btn-soft btn-sm" id="detailCloseBtn"><i class="fa-solid fa-xmark"></i></button>
    </div>

    <div class="order-details-body">
      <div class="order-details-section-title">Basic Info</div>
      <p><strong>Status:</strong> <span id="detailStatus"></span></p>
      <p><strong>Customer:</strong> <span id="detailCustomer"></span></p>
      <p><strong>Phone:</strong> <span id="detailPhone"></span></p>
      <p><strong>Address:</strong> <span id="detailAddress"></span></p>
      <p><strong>Payment:</strong> <span id="detailPayment"></span></p>
      <p><strong>Amount:</strong> <span id="detailAmount"></span></p>

      <div class="order-details-section-title">Operations</div>
      <p><strong>Packer:</strong> <span id="detailPacker"></span></p>
      <p><strong>Rider:</strong> <span id="detailRider"></span></p>

      <div class="order-details-section-title">Items</div>
      <div class="order-items" id="detailItems"></div>

      <div class="order-details-section-title">Timeline</div>
      <div class="timeline" id="detailTimeline"></div>

      <div class="actions-block">
        <h4>Order Actions (demo)</h4>
        <button class="btn btn-primary" id="btnUpdateStatus">Update Status</button>
        <button class="btn btn-soft" id="btnAssignRider">Assign Rider</button>
        <button class="btn btn-soft" id="btnMarkPacked">Mark Packed</button>
        <button class="btn btn-soft" id="btnMarkDispatched">Mark Dispatched</button>
        <button class="btn btn-soft" id="btnMarkDelivered">Mark Delivered</button>
        <button class="btn btn-soft" id="btnForcePlace">Force Place</button>
        <button class="btn btn-soft" style="background:#3b0e19;border-color:#7f1d1d;color:#fecaca" id="btnCancelOrder">
          Cancel Order
        </button>
      </div>
    </div>
  </div>
</div>

<script>
// JS goes here – paste code from the "Full JavaScript" block.
// ===== DEMO DATA =====
const orders = [
  {
    id:"QD-1001",
    status:"Pending",
    customer:"Aman Gupta",
    packer:"Rakesh",
    rider:"R-01",
    amount:420.50,
    phone:"+91 98765 00001",
    address:"B-12, Green Park, Delhi",
    payment:"COD",
    items:[
      {name:"Amul Milk 1L",qty:2,price:65},
      {name:"Brown Bread",qty:1,price:40}
    ],
    timeline:["Created","Pending"]
  },
  {
    id:"QD-1002",
    status:"Processing",
    customer:"Riya Sharma",
    packer:"Ankit",
    rider:"R-05",
    amount:680.00,
    phone:"+91 98765 00002",
    address:"Flat 304, Lakeview, Mumbai",
    payment:"Online",
    items:[
      {name:"Fortune Rice 5kg",qty:1,price:550},
      {name:"Oil 1L",qty:1,price:130}
    ],
    timeline:["Created","Packed","Processing"]
  },
  {
    id:"QD-1003",
    status:"Packed",
    customer:"Sameer Khan",
    packer:"Neha",
    rider:"R-02",
    amount:250.75,
    phone:"+91 98765 00003",
    address:"Near City Mall, Pune",
    payment:"COD",
    items:[
      {name:"Eggs 12pc",qty:1,price:80},
      {name:"Juice 1L",qty:2,price:85}
    ],
    timeline:["Created","Packed"]
  },
  {
    id:"QD-1004",
    status:"Dispatched",
    customer:"Priya Verma",
    packer:"Ankit",
    rider:"R-03",
    amount:520.30,
    phone:"+91 98765 00004",
    address:"Sector 18, Noida",
    payment:"Online",
    items:[
      {name:"Atta 5kg",qty:1,price:280},
      {name:"Sugar 1kg",qty:1,price:60},
      {name:"Tea 500g",qty:1,price:180}
    ],
    timeline:["Created","Packed","Dispatched"]
  },
  {
    id:"QD-1005",
    status:"Delivered",
    customer:"Kunal Mehta",
    packer:"Rakesh",
    rider:"R-04",
    amount:199.00,
    phone:"+91 98765 00005",
    address:"IT Park, Bengaluru",
    payment:"Online",
    items:[
      {name:"Maggi 12 pack",qty:1,price:99},
      {name:"Coke 1.25L",qty:1,price:100}
    ],
    timeline:["Created","Packed","Dispatched","Delivered"]
  },
  {
    id:"QD-1006",
    status:"Cancelled",
    customer:"Sneha",
    packer:"Neha",
    rider:"",
    amount:320,
    phone:"+91 98765 00006",
    address:"Airport Road, Hyderabad",
    payment:"COD",
    items:[
      {name:"Cheese 200g",qty:2,price:160}
    ],
    timeline:["Created","Cancelled"]
  },
  // add some more for pagination demo
  ...Array.from({length:12}).map((_,i)=>({
    id:`QD-10${10+i}`,
    status: i % 5 === 0 ? "Pending" :
            i % 5 === 1 ? "Processing" :
            i % 5 === 2 ? "Packed" :
            i % 5 === 3 ? "Dispatched" :
            "Delivered",
    customer:`Demo Customer ${i+1}`,
    packer: ["Rakesh","Ankit","Neha"][i%3],
    rider: ["R-01","R-02","R-03","R-04",""][i%5],
    amount: 100 + i*10,
    phone:"+91 90000 00"+(10+i),
    address:`Sample address ${i+1}`,
    payment: i%2===0 ? "COD" : "Online",
    items:[{name:"Demo Item",qty:1,price:100+i*5}],
    timeline:["Created"]
  }))
];

const riders = [
  {id:"R-01",name:"Rahul Rider",ordersToday:12,status:"Active"},
  {id:"R-02",name:"Sanjay Rider",ordersToday:9,status:"Active"},
  {id:"R-03",name:"Imran Rider",ordersToday:7,status:"On Break"},
  {id:"R-04",name:"Ali Rider",ordersToday:5,status:"Offline"},
  {id:"R-05",name:"Vikas Rider",ordersToday:11,status:"Active"}
];

const customers = [
  {id:"C-1001",name:"Aman Gupta",email:"aman@example.com",orders:12},
  {id:"C-1002",name:"Riya Sharma",email:"riya@example.com",orders:8},
  {id:"C-1003",name:"Kunal Mehta",email:"kunal@example.com",orders:4}
];

const inventory = [
  {sku:"AM-001",name:"Amul Milk 1L",qty:65},
  {sku:"BR-020",name:"Brown Bread",qty:4},
  {sku:"EG-100",name:"Eggs 12pc",qty:2},
  {sku:"RC-501",name:"Fortune Rice 5kg",qty:33}
];

const warehouses = [
  {
    name:"Central Warehouse",
    bins:[
      {bin:"A-01",item:"Milk",qty:320},
      {bin:"A-02",item:"Bread",qty:40},
      {bin:"A-03",item:"Rice",qty:120},
      {bin:"A-04",item:"Oil",qty:70}
    ]
  },
  {
    name:"North Hub",
    bins:[
      {bin:"B-01",item:"Snacks",qty:60},
      {bin:"B-02",item:"Drinks",qty:45}
    ]
  }
];

// ===== GLOBAL STATE =====
let currentPage = 1;
const ordersPerPage = 10;
let selectedOrderId = null;

// ===== HELPERS =====
function $(sel){return document.querySelector(sel);}
function $all(sel){return document.querySelectorAll(sel);}

function statusClass(status){
  switch(status){
    case "Pending": return "s-pending";
    case "Processing": return "s-processing";
    case "Packed": return "s-packed";
    case "Dispatched": return "s-dispatched";
    case "Delivered": return "s-delivered";
    case "Cancelled": return "s-cancelled";
    default: return "";
  }
}

// ===== NAVIGATION =====
function initNavigation(){
  $all(".nav li").forEach(li=>{
    li.addEventListener("click",()=>{
      const page = li.dataset.page;
      // active nav
      $all(".nav li").forEach(x=>x.classList.remove("active"));
      li.classList.add("active");

      // show page
      $all(".page").forEach(p=>p.classList.remove("page-active"));
      const target = document.getElementById(page+"Page");
      if(target) target.classList.add("page-active");
    });
  });
}

// ===== DASHBOARD RENDER =====
function renderDashboard(){
  $("#statTotalOrders").textContent = orders.length;
  $("#statRiders").textContent = riders.length;
  $("#statCustomers").textContent = customers.length;
  $("#statInventory").textContent = inventory.length;

  const tbody = $("#recentOrdersTable tbody");
  tbody.innerHTML = "";
  orders.slice(0,5).forEach(o=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${o.id}</td>
      <td>${o.customer}</td>
      <td><span class="badge ${statusClass(o.status)}">${o.status}</span></td>
      <td>₹${o.amount.toFixed(2)}</td>
    `;
    tbody.appendChild(tr);
  });
}

// ===== LIVE ORDERS TABLE + PAGINATION =====
function getFilteredOrders(){
  const q = $("#orderSearch").value.trim().toLowerCase();
  if(!q) return orders;
  return orders.filter(o=>o.id.toLowerCase().includes(q));
}

function renderOrdersTable(){
  const tbody = $("#ordersTable tbody");
  tbody.innerHTML = "";

  const filtered = getFilteredOrders();
  const totalPages = Math.max(1, Math.ceil(filtered.length/ordersPerPage));
  if(currentPage > totalPages) currentPage = totalPages;

  const start = (currentPage-1)*ordersPerPage;
  const pageOrders = filtered.slice(start,start+ordersPerPage);

  pageOrders.forEach(o=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="order-id-link" data-id="${o.id}" style="color:var(--neon1);font-weight:600;cursor:pointer;">${o.id}</td>
      <td><span class="badge ${statusClass(o.status)}">${o.status}</span></td>
      <td>${o.customer}</td>
      <td>${o.packer || "—"}</td>
      <td>${o.rider || "—"}</td>
      <td>
        <button class="btn btn-soft btn-sm manage-btn" data-id="${o.id}">
          Manage
        </button>
      </td>
    `;
    tbody.appendChild(tr);
  });

  attachOrderRowEvents();
  renderOrdersPagination(filtered.length);
}

function renderOrdersPagination(total){
  const container = $("#ordersPagination");
  container.innerHTML = "";
  const totalPages = Math.max(1, Math.ceil(total/ordersPerPage));

  if(totalPages <= 1) return;

  // Prev
  const prevBtn = document.createElement("button");
  prevBtn.textContent = "Prev";
  prevBtn.disabled = currentPage === 1;
  prevBtn.addEventListener("click",()=>{
    if(currentPage>1){currentPage--;renderOrdersTable();}
  });
  container.appendChild(prevBtn);

  for(let i=1;i<=totalPages;i++){
    const b = document.createElement("button");
    b.textContent = i;
    if(i===currentPage) b.classList.add("active");
    b.addEventListener("click",()=>{
      currentPage = i;
      renderOrdersTable();
    });
    container.appendChild(b);
  }

  // Next
  const nextBtn = document.createElement("button");
  nextBtn.textContent = "Next";
  nextBtn.disabled = currentPage === totalPages;
  nextBtn.addEventListener("click",()=>{
    if(currentPage<totalPages){currentPage++;renderOrdersTable();}
  });
  container.appendChild(nextBtn);
}

function attachOrderRowEvents(){
  // Click on Order ID
  $all(".order-id-link").forEach(td=>{
    td.addEventListener("click",()=>{
      const id = td.dataset.id;
      openOrderDetails(id);
    });
  });
  // Manage button
  $all(".manage-btn").forEach(btn=>{
    btn.addEventListener("click",()=>{
      const id = btn.dataset.id;
      openOrderDetails(id);
    });
  });
}

// ===== ORDER DETAILS PANEL =====
function openOrderDetails(orderId){
  const order = orders.find(o=>o.id===orderId);
  if(!order) return;
  selectedOrderId = orderId;

  $("#detailOrderId").textContent = order.id;
  $("#detailStatus").textContent = order.status;
  $("#detailCustomer").textContent = order.customer;
  $("#detailPhone").textContent = order.phone || "—";
  $("#detailAddress").textContent = order.address || "—";
  $("#detailPayment").textContent = order.payment || "—";
  $("#detailAmount").textContent = "₹"+order.amount.toFixed(2);
  $("#detailPacker").textContent = order.packer || "—";
  $("#detailRider").textContent = order.rider || "—";

  const itemsContainer = $("#detailItems");
  itemsContainer.innerHTML = "";
  order.items.forEach(it=>{
    const row = document.createElement("div");
    row.className = "order-items-row";
    row.innerHTML = `
      <span>${it.name} (x${it.qty})</span>
      <span>₹${it.price.toFixed(2)}</span>
    `;
    itemsContainer.appendChild(row);
  });

  const timelineContainer = $("#detailTimeline");
  timelineContainer.innerHTML = "";
  order.timeline.forEach(step=>{
    const span = document.createElement("span");
    span.textContent = step;
    timelineContainer.appendChild(span);
  });

  $("#orderDetailsBackdrop").classList.add("open");
}

function closeOrderDetails(){
  $("#orderDetailsBackdrop").classList.remove("open");
  selectedOrderId = null;
}

// ===== ORDER ACTIONS (DEMO) =====
function getSelectedOrder(){
  if(!selectedOrderId) return null;
  return orders.find(o=>o.id===selectedOrderId);
}

function updateStatus(newStatus){
  const o = getSelectedOrder();
  if(!o) return;
  o.status = newStatus;
  o.timeline.push(newStatus);
  alert(`Status updated to ${newStatus} (demo only)`);
  renderDashboard();
  renderOrdersTable();
  openOrderDetails(o.id); // refresh details
}

function assignRider(){
  const o = getSelectedOrder();
  if(!o) return;
  const names = riders.map(r=>`${r.id} - ${r.name}`).join("\n");
  const chosen = prompt("Assign Rider (type Rider ID):\n\n"+names, o.rider || "R-01");
  if(!chosen) return;
  o.rider = chosen;
  o.timeline.push("Assigned: "+chosen);
  alert(`Rider ${chosen} assigned (demo only)`);
  renderOrdersTable();
  openOrderDetails(o.id);
}

function genericAction(label, status){
  const o = getSelectedOrder();
  if(!o) return;
  o.status = status;
  o.timeline.push(label);
  alert(`${label} (demo only)`);
  renderDashboard();
  renderOrdersTable();
  openOrderDetails(o.id);
}

function cancelOrder(){
  const o = getSelectedOrder();
  if(!o) return;
  const reason = prompt("Cancel order — reason?", "Customer request");
  if(reason === null) return;
  o.status = "Cancelled";
  o.timeline.push("Cancelled: "+reason);
  alert("Order cancelled (demo)");
  renderDashboard();
  renderOrdersTable();
  openOrderDetails(o.id);
}

// ===== RIDERS / CUSTOMERS / INVENTORY / WAREHOUSE =====
function renderRiders(){
  const tbody = $("#ridersTable tbody");
  tbody.innerHTML="";
  riders.forEach(r=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r.id}</td>
      <td>${r.name}</td>
      <td>${r.ordersToday}</td>
      <td>${r.status}</td>
    `;
    tbody.appendChild(tr);
  });
}

function renderCustomers(){
  const tbody = $("#customersTable tbody");
  tbody.innerHTML="";
  customers.forEach(c=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${c.id}</td>
      <td>${c.name}</td>
      <td>${c.email}</td>
      <td>${c.orders}</td>
    `;
    tbody.appendChild(tr);
  });
}

function renderInventory(){
  const tbody = $("#inventoryTable tbody");
  tbody.innerHTML="";
  inventory.forEach(i=>{
    const low = i.qty <= 5;
    const lowText = low ? "Yes" : "No";
    const lowColor = low ? "#ff6b81" : "#20e3a5";
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i.sku}</td>
      <td>${i.name}</td>
      <td>${i.qty}</td>
      <td style="color:${lowColor}">${lowText}</td>
    `;
    tbody.appendChild(tr);
  });
}

function renderWarehouse(){
  const card = $("#warehouseCard");
  card.innerHTML="";
  warehouses.forEach(w=>{
    const div = document.createElement("div");
    div.style.marginBottom = "10px";
    let html = `<strong>${w.name}</strong><br>`;
    w.bins.forEach(b=>{
      html += `<span style="font-size:13px;color:var(--muted)">${b.bin} — ${b.item}: ${b.qty} pcs</span><br>`;
    });
    div.innerHTML = html;
    card.appendChild(div);
  });
}

// ===== GLOBAL SEARCH (simple demo) =====
function initGlobalSearch(){
  $("#globalSearch").addEventListener("input",()=>{
    // Abhi sirf live orders ke order id & customer par filter karenge agar orders page active hai
    const ordersPageActive = $("#ordersPage").classList.contains("page-active");
    if(!ordersPageActive) return;
    $("#orderSearch").value = $("#globalSearch").value;
    currentPage = 1;
    renderOrdersTable();
  });
}

// ===== INIT =====
document.addEventListener("DOMContentLoaded",()=>{
  initNavigation();
  initGlobalSearch();

  // listeners for search in live orders
  $("#orderSearch").addEventListener("input",()=>{
    currentPage = 1;
    renderOrdersTable();
  });

  // order details close
  $("#detailCloseBtn").addEventListener("click",closeOrderDetails);
  $("#orderDetailsBackdrop").addEventListener("click",e=>{
    if(e.target.id === "orderDetailsBackdrop") closeOrderDetails();
  });

  // action buttons
  $("#btnUpdateStatus").addEventListener("click",()=>{
    const o = getSelectedOrder();
    if(!o) return;
    const newStatus = prompt("Update status to (Pending / Processing / Packed / Dispatched / Delivered):", o.status);
    if(!newStatus) return;
    updateStatus(newStatus);
  });
  $("#btnAssignRider").addEventListener("click",assignRider);
  $("#btnMarkPacked").addEventListener("click",()=>genericAction("Marked Packed","Packed"));
  $("#btnMarkDispatched").addEventListener("click",()=>genericAction("Marked Dispatched","Dispatched"));
  $("#btnMarkDelivered").addEventListener("click",()=>genericAction("Delivered","Delivered"));
  $("#btnForcePlace").addEventListener("click",()=>genericAction("Force Placed","Processing"));
  $("#btnCancelOrder").addEventListener("click",cancelOrder);

  // initial renders
  renderDashboard();
  renderOrdersTable();
  renderRiders();
  renderCustomers();
  renderInventory();
  renderWarehouse();
});

</script>
</body>
</html>

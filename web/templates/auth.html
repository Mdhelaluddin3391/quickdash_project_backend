{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login or Signup - QuickDash</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="stylesheet" href="{% static 'css/auth_style.css' %}">
</head>

<body>

    <div class="auth-container">
        <div class="auth-card">

            <a href="index.html" class="close-btn" title="Close">
                <i class="fas fa-times"></i>
            </a>

            <div class="auth-header">
                <i class="fas fa-mobile-alt header-icon"></i>
                <h2>Login or Signup</h2>
                <p>Enter your mobile number to get an OTP</p>
            </div>

            <form id="phone-form" class="auth-form">
                <label for="phone">Mobile Number</label>
                <div class="input-group">
                    <span class="country-code">+91</span>
                    <input type="tel" id="phone" name="phone" placeholder="Enter your 10-digit mobile number"
                        maxlength="10" required>
                </div>
                <button type="submit" class="submit-btn">
                    <span>Get OTP</span>
                </button>
            </form>

            <form id="otp-form" class="auth-form" style="display: none;">
                <label for="otp">Enter OTP</label>
                <p class="otp-info">We've sent a 6-digit OTP to <strong id="phone-display">+91 9876543210</strong>.
                    <a href="#" id="change-number">Change</a>
                </p>
                <div class="input-group otp-inputs">
                    <input type="tel" class="otp-box" maxlength="1" data-index="0">
                    <input type="tel" class="otp-box" maxlength="1" data-index="1">
                    <input type="tel" class="otp-box" maxlength="1" data-index="2">
                    <input type="tel" class="otp-box" maxlength="1" data-index="3">
                    <input type="tel" class="otp-box" maxlength="1" data-index="4">
                    <input type="tel" class="otp-box" maxlength="1" data-index="5">
                </div>
                <button type="submit" class="submit-btn" id="verify-btn">
                    <span>Verify & Proceed</span>
                </button>
                <div class="resend-timer">
                    Resend OTP in <span id="timer">30s</span>
                </div>
            </form>

            <div class="auth-footer">
                By continuing, you agree to our
                <a href="#">Terms of Service</a> & <a href="#">Privacy Policy</a>.
            </div>

        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const phoneForm = document.getElementById('phone-form');
            const otpForm = document.getElementById('otp-form');
            const changeNumberLink = document.getElementById('change-number');
            const phoneDisplay = document.getElementById('phone-display');
            const verifyBtn = document.getElementById('verify-btn');
            const timerDisplay = document.getElementById('timer');
            const otpBoxes = document.querySelectorAll('.otp-box');

            let countdown;
            let timeLeft = 30;

            // Handle "Get OTP" click
            phoneForm.addEventListener('submit', (e) => {
                e.preventDefault();

                const phoneInput = document.getElementById('phone');
                const phoneValue = phoneInput.value.trim();

                // Basic phone validation
                if (!/^\d{10}$/.test(phoneValue)) {
                    phoneInput.parentElement.classList.add('shake');
                    setTimeout(() => {
                        phoneInput.parentElement.classList.remove('shake');
                    }, 300);
                    phoneInput.focus();
                    return;
                }

                // Update phone number display
                phoneDisplay.innerText = `+91 ${phoneValue}`;

                // Show loading state
                const submitBtn = phoneForm.querySelector('.submit-btn');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<div class="spinner"></div><span>Sending OTP...</span>';
                submitBtn.disabled = true;

                // Simulate API call
                setTimeout(() => {
                    // Switch forms
                    phoneForm.style.display = 'none';
                    otpForm.style.display = 'block';

                    // Reset button
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;

                    // Focus first OTP box
                    otpBoxes[0].focus();

                    // Start timer
                    startTimer();
                }, 1500);
            });

            // Handle "Change" link click
            changeNumberLink.addEventListener('click', (e) => {
                e.preventDefault();
                otpForm.style.display = 'none';
                phoneForm.style.display = 'block';

                // Clear timer
                if (countdown) {
                    clearInterval(countdown);
                }
            });

            // Handle OTP input
            otpBoxes.forEach((box, index) => {
                box.addEventListener('input', (e) => {
                    const value = e.target.value;

                    // Auto-focus next box if value entered
                    if (value && index < otpBoxes.length - 1) {
                        otpBoxes[index + 1].focus();
                    }

                    // Update filled state
                    if (value) {
                        box.classList.add('filled');
                    } else {
                        box.classList.remove('filled');
                    }

                    // Enable verify button if all boxes filled
                    const allFilled = Array.from(otpBoxes).every(box => box.value);
                    verifyBtn.disabled = !allFilled;
                });

                box.addEventListener('keydown', (e) => {
                    // Handle backspace
                    if (e.key === 'Backspace' && !box.value && index > 0) {
                        otpBoxes[index - 1].focus();
                    }

                    // Handle arrow keys
                    if (e.key === 'ArrowLeft' && index > 0) {
                        otpBoxes[index - 1].focus();
                    }
                    if (e.key === 'ArrowRight' && index < otpBoxes.length - 1) {
                        otpBoxes[index + 1].focus();
                    }
                });

                // Prevent non-digit input
                box.addEventListener('keypress', (e) => {
                    if (!/\d/.test(e.key)) {
                        e.preventDefault();
                    }
                });
            });

            // Handle OTP form submission
            otpForm.addEventListener('submit', (e) => {
                e.preventDefault();

                // Get OTP value
                const otp = Array.from(otpBoxes).map(box => box.value).join('');

                // Show loading state
                const originalText = verifyBtn.innerHTML;
                verifyBtn.innerHTML = '<div class="spinner"></div><span>Verifying...</span>';
                verifyBtn.disabled = true;

                // Simulate verification
                setTimeout(() => {
                    // In a real app, you would verify the OTP with your backend
                    alert(`OTP ${otp} verified successfully! Redirecting...`);

                    // Reset button
                    verifyBtn.innerHTML = originalText;
                    verifyBtn.disabled = false;

                    // Here you would redirect the user to the dashboard
                    // window.location.href = 'dashboard.html';
                }, 1500);
            });

            // Timer function
            function startTimer() {
                timeLeft = 30;
                timerDisplay.textContent = `${timeLeft}s`;

                if (countdown) {
                    clearInterval(countdown);
                }

                countdown = setInterval(() => {
                    timeLeft--;
                    timerDisplay.textContent = `${timeLeft}s`;

                    if (timeLeft <= 0) {
                        clearInterval(countdown);
                        timerDisplay.parentElement.innerHTML =
                            '<a href="#" id="resend-otp">Resend OTP</a>';

                        document.getElementById('resend-otp').addEventListener('click', (e) => {
                            e.preventDefault();
                            // Resend OTP logic would go here
                            alert('OTP has been resent!');
                            startTimer();
                        });
                    }
                }, 1000);
            }
        });
    </script>

</body>

</html>